## 云计算

云服务提供商：亚马逊、微软、阿里、谷歌、华为

**ECS—弹性云服务器**

**云计算优势**：按需自助，广泛的网络接入，资源池化，快速弹性伸缩(突发流量增加虚拟机)，可计量服务(计费、业务调整)

**云计算服务模式**：Iaas：基础设施服务、Paas：平台及服务、Saas：软件服务，aPaaS：应用平台级服务 0代码开发

**虚拟化**：将物理资源(计算、存储、网络)→通过虚拟化层(软件层、VMM、Hypervisor)→实现虚拟化资源

**虚拟化分为**：计算虚拟化，存储虚拟化，网络虚拟化

> 虚拟机用到的资源都是虚拟化资源。
>
> 虚拟机在底层存放时，分为两种文件：
>
> 1.配置文件  存放的是虚拟机的各种配置信息（网卡，CPU，内存）
>
> 2.磁盘文件  当前虚拟机磁盘中所有数据



计算资源虚拟化分为：CPU虚拟化，内存虚拟化，I/O设备虚拟化	

CPU虚拟化：

​	1.分级保护域：Ring-Ring3

​		OS处于Ring 0，权限最高，可以操作硬件

​		App处于Ring 3级别，无法操作硬件

​	2.指令

​		特权指令——Ring 0

​		非特权指令——任何级别

​		敏感指令——Ring 0

> 解决x86架构虚拟化，有三种方案：
>
> 1.全虚	所有虚拟机指令全部捕捉，对其中19条进行处理（BT 二进制翻译）
>
> 2.半虚	虚拟机主要将19条敏感指令交给虚拟化层，超级调用（知道自己是虚拟机）
>
> 3.硬虚（硬虚辅助虚拟化）	如何开启？计算机开机时，进入BIOS。

内存虚拟化：

​	虚拟内存在物理内存中不连续

I/O虚拟化：

​	全虚，半虚，IO透传



主流计算虚拟化技术

+ 开源：KVM、Xen
+ 闭源：Hyper-v（微软windows企业版），VMware ESXi（Workstaion PC  ESXi 服务器），Huawei FusionSphere(华为虚拟化套件)



KVM体系架构

Libvirt，集成各种驱动，不能直接操作，有一个API接口

​	管理工具	Virsh：命令行工具

​						Virt-Manager：图形化界面（虚拟系统管理器）

​						Virt-Install：虚拟机的安装工具

用户空间：APP	内核空间：OS(Host OS)



FusionCompute

FC虚拟化软件

将物理资源转换成虚拟资源（虚拟机）

FC一般在服务器上，企业，I型虚拟化

FC的版本更迭：6.1（Xen）,6.2(KVM)，6.5，8.0（支持ARM架构的CPU）

FC:

VRM：虚拟资源管理.iso

CNA：计算节点代理.iso

FC的优势：

1.集中管理

2.支持异构部署，兼容多种硬件（X86，ARM）

3.计算机资源统一调度	负载均衡	节能

4.FC可实现用户管理

5.可手工安装，也有安装工具

FC的安装：

VRM——既可以安装在虚拟机上，也可以安装在物理服务器上

CNA——安装在物理服务器上



**虚拟化的优势**：1.提高资源利用率（降低成本）2.解耦（OS与硬件不强关联）3.灵活性4.运行在软件层之上的OS都有自己的生命周期





**网络基础概念：广播和单播，路由，默认网关，VLAN**

**网络四要素：**终端设备、传输介质（有线，无线）、传输设备（路由器，交换机 ，防火墙）、网络协议(TCP、IP、UDP、ARP、ICMP)

IP地址（计算机名字）：长32bit的二进制整数，通常以点分十进制表示	192.168.0.122

​										分为两部分

​										网络位：表明主机属于哪一个网段，网络相同表明两台主机属于同一个网段

​										主机位：用于区分属于同一个网段的不同主机

掩码：用于区分网络位和主机位

​			对应的网络位为1，主机位为0

​			192.168.0.122/24

​			192.168.0.122	255.255.255.0

MAC地址：烧录在网卡中的一段数字，长48bit，一般以十六进制表示

​					04-D3-B0-66-22-4A

​					82-FA-FC-13-9C-A1

​					一个合法的MAC地址是全球唯一的



封装：计算机将数据逐层（分层模型），向下添加报头和报尾的过程



路由：选路



MAC地址分三类：

单播MAC：第八位为0

组播MAC：第八位为1

广播MAC：48位为1



网关：

用于转发不同网段之间的数据，不具体特指一类产品

网关的作用需要通过具体的设备来承载，比如路由器，三层交换机，防火墙，虚拟三层交换机

配置网关：必须和IP同一个网段，主机位不能全为0或全为1、也不能和IP冲突



MAC地址表：看成一个数据库

学习机制：学习数据包的SMAC的和接受该数据包的接口的映射关系

MAC地址表默认刚开启的时候，是空的。

交换机从接口接收到数据，会将数据的SMAC和接收该数据接口的映射关系，放入MAC地址表



交换机的转发行为：

1.泛洪：交换机从一个接口收到数据，从其他所有接口把这个数据发送出去（不包括接受数据的接口）

2.转发：交换机从一个接口收到数据，从另外一个接口把这个数据发送出去

3.丢弃：交换机从一个接口收到数据，解封装之后，直接丢弃不转发



交换机的工作原理：根据交换机收到的数据帧不同，对应的处理方式也不一样

交换机收到单播帧：查表（MAC地址表）

​	能查到：比较接收该数据的接口是否等于查表后的出接口

​		等于：丢弃

​		不等于：直接按表转发

交换机收到广播帧：泛洪

交换机收到组播帧：泛洪



VLAN 虚拟局域网：

用于隔离广播域，提升网络安全，以及网络可靠性

PVID：Port VLANID端口的vlanid值

交换机的每一个接口都有一个pvid值，默认情况下，为1

pvid值可手动修改



链路类型：两种

交换机连接终端的链路：接入链路

交换机连接交换机的链路：干道链路

端口类型：

access端口类型

trunk端口类型



tagged帧：打上了vlan的数据帧

untagged帧：没有打上vlan的数据帧

主机发送出来的数据永远都是没有打上vlan的数据帧

交换机发送出来的数据永远都是打上了vlan的数据帧



access端口的收发规则：
接受数据：

​	接收的是untagged帧：给该数据帧打上tag，打上的tag值等于接口的pvid值

​	接收的是tagged帧：比较tagged帧所打上的vlan和接口的pvid值是否一致

​		一致，则接收

​		不一致，则丢弃

发送数据：

​	比较tagged帧所打上的vlan和接口的pvid是否一致

​		一致，剥离vlan发送

​		不一致，则丢弃

![image-20211012114651030](C:\Users\86181\AppData\Roaming\Typora\typora-user-images\image-20211012114651030.png)



trunk端口的收发规则：

allow-pass表：允许通过列表，默认只允许vlan 1通过，可以通过配置添加相应的vlan

接受数据：
	接收的是untagged帧：给该数据帧打上tag，打上的tag值等于接口的pvid值
	接收的是tagged帧：查表（允许通过列表）
		能查到：直接接收
		查不到：丢弃

发送数据：查表（允许通过列表）
	能查到：比较数据帧所打上的vlan和trunk端口的pvid值是否一致
		一致：剥离vlan发送
		不一致：直接携带vlan发送
	查不到：丢弃



二层交换机：（只到数据链路层）

三层交换机：可配置IP地址，作为网关，可以转发不同网段数据



**虚拟化中网络的架构**

SDN技术：软件定义网络

东西向流量

南北向流量





桥接和NAT

NAT设备作为VM的网关，将SIP进行转换

NAT设备：做IP地址转换，从而使虚拟机访问外网

场景：VM想要访问8.8.8.8

VMnet8：用于虚拟机和主机之间的通信

桥接：物理接口虽然配了IP地址，但是不会生效（透明），相当于一台交换机



虚拟交换机 - Open vSwitch

作用：虚拟机之间的通信

VSP虚拟交换机接口

端口组（Port group）：多个vsp的集合



Ovs：
1.开源的虚拟交换机
2.基于C语言开发
3.实现网络可编程（可以对数据进行改变）
4.应用在虚拟化以及SDN（软件定义网络）

工作原理：
基于流表转发：



执行动作：转发（基于端口转发，基于MAC转发）
					丢弃
					修改
					迭代（转到下一个tabel）

openflow标准，满足SDN网络转控分离



Linux安装：

源码安装：通过命令
二进制安装：通过二进制文件，.rpm软件包



分布式虚拟交换机Dvs



**云计算中的存储基础知识**

存储：磁盘，磁带，光盘

磁盘：两种

HDD	机械硬盘	采用磁性碟片
SSD  	固态硬盘	采用闪存颗粒
混合硬盘（不常用）



柱面
磁道
扇区
	可以唯一定位一个存储单元



读写数据都是以扇区为单位



物理磁盘类型  -  SATA盘	7200转/min	1.0	150MB/s
																	  2.0	300MB/s
																	  3.0	600MB/s

​							SAS盘	15K转/min	SCSI技术	向下兼容	1.0	3Gb/s 
​																									    2.0	6Gb/s
​																									    3.0	12Gb/s

​							SSD盘	控制芯片+存储芯片
​										   存储芯片分为两种：
​										   易失性存储
​										   非易失性存储（闪存颗粒）	SLC	一个bit地存
​																							 MLC



RAID技术
	技术实现：
		硬件实现：RAID卡
		软件实现：

常用RAID类型	RAID 0（性能好，安全性差），RAID 1（安全性好），RAID5（奇偶校验），RAID6



集中式存储类型	SAN、NAS

分布式存储
