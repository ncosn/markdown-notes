### 数据管理概述

#### 运作机制

+ 用户首选项（Preferences）：不支持分布式同步，常用于保存应用配置信息、用户偏好设置

+ 键值型数据管理（KV-Store）：使用分布式能力时，KV-Store会将同步请求发送给DatamgrService由其完成跨设备数据同步
+ 关系型数据管理（RelationalStore）：使用分布式能力时，RelationalStore部件会将同步请求发送给DatamgrService由其完成跨设备数据同步



### 用户首选项持久化

Preferences会将该数据缓存在内存中，当用户读取的时候，能够快速从内存中获取数据。

Preferences会随存放数据量越多，导致应用占用内存越大，不适合存放过多数据。

#### 运作机制

Preferences实例

#### 注意事项

key键为string类型，非空且长度不超过80字节；如果value值为string类型，请使用utf-8编码格式，可以为空，长度不超过8192字节

建议存储的数据不超过一万条

持久化文件路径/data/app/el2/100/base/com.example.xxx/haps/entry/preferences/



可以通过on('change')来监听变化



### 键值型数据库持久化

设备协同数据库，key长度<896Byte，Value长度<4MB

单版本数据库，Key长度<=1KB，Value长度<4MB

每个应用程序最多支持同时打开16个键值型分布式数据库

回调中不允许进行阻塞操作（比如渲染UI，类似修改AppStorage触发渲染）



```ts
let config: distributeKVStore.KVManagerConfig = {
    bundleName: 'com.example.lavadatamanagertest',
    context: this.context
}
distributeKVStore.createKVManager(config)

// 获取单版本数据库
let options: distributeKVStore.Options = {
    createIfMissing = true,
    encrypt: false,
    kvStoreType: distributedKVStore.KVStoreType.SINGLE_VERSION,
    securityLevel: distributeKVStore.SecurityLevel.S2
}
let KVStore: distributeKVStore.SingleStore = await KVManager.getKVStore<distributeStore.SingleKVStore>('laval_KVStore', options);
```



持久化文件路径/data/app/el2/100/database/com.example.xxx/entry/kvdb/e95***76e/single_ver/main/



### 关系型数据库持久化

存储复杂关系数据



#### 运行机制

底层使用SQLite

+ 系统默认日志方式是WAL（Write Ahead Log）模式，系统默认落盘方式是FULL模式。
+ 连接池最大数量是4个，用以管理用户的读操作
+ 同一时间只能支持一个写操作
+ 应用卸载被自动清除



> 用户首选项和键值型数据库怎么选？
>
> 效率与性能不同：
>
> Preferences将文件全部加载到内存中，内存开销大，但速度比较快，效率高
>
> 数据库性能好

